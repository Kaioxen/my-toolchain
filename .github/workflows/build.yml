name: Build GCC 9.3.0 for AArch64

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build GCC in Docker
        run: |
          docker run --rm -v $(pwd):/workspace ubuntu:18.04 bash -c "
            cd /workspace
            
            # Install dependencies dasar
            apt-get update
            apt-get install -y wget xz-utils build-essential libgmp-dev libmpfr-dev libmpc-dev flex bison texinfo
            
            # Download GCC 9.3.0
            wget -q https://ftpmirror.gnu.org/gcc/gcc-9.3.0/gcc-9.3.0.tar.xz
            tar -xf gcc-9.3.0.tar.xz
            cd gcc-9.3.0
            
            # Download bumbu tambahan (prerequisites)
            ./contrib/download_prerequisites
            cd ..
            
            # Buat folder build agar source tetap bersih
            mkdir -p build-gcc && cd build-gcc
            
            # Konfigurasi GCC 9.3.0 (Sesuai spek kernel Android 4.9)
            ../gcc-9.3.0/configure \
              --prefix=/workspace/gcc-9.3-aarch64 \
              --target=aarch64-linux-gnu \
              --enable-languages=c,c++ \
              --with-arch=armv8-a \
              --disable-multilib \
              --disable-nls \
              --disable-libcc1 \
              --disable-libsanitizer \
              --disable-bootstrap \
              --disable-threads \
              --without-headers \
              --with-newlib
            
            # Compile (GitHub Actions punya 2 core kencang)
            make -j$(nproc)
            make install
            
            cd ..
            # Kompres hasil build
            tar -czvf gcc-9.3-linux-aarch64.tar.gz gcc-9.3-aarch64
          "

      - name: Upload GCC Result
        uses: actions/upload-artifact@v4
        with:
          name: gcc-9.3-aarch64-toolchain
          path: gcc-9.3-linux-aarch64.tar.gz
