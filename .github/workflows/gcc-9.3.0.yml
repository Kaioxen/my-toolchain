name: Build GCC 9.3.0 Native AArch64

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Build GCC in Docker
        run: |
          # Kita pakai Ubuntu 18.04 di dalam Docker sesuai permintaan lu
          docker run --rm -v $(pwd):/workspace ubuntu:18.04 bash -c "
            cd /workspace
            
            # Install dependencies untuk nge-build GCC
            apt-get update
            apt-get install -y wget tar xz-utils build-essential \
                               gcc-aarch64-linux-gnu g++-aarch64-linux-gnu \
                               bison flex libgmp-dev libmpfr-dev libmpc-dev texinfo

            # Download Source GCC 9.3.0
            wget https://ftp.gnu.org/gnu/gcc/gcc-9.3.0/gcc-9.3.0.tar.gz
            tar -xf gcc-9.3.0.tar.gz
            cd gcc-9.3.0
            # Download library pendukung (GMP, MPFR, MPC) internal
            ./contrib/download_prerequisites
            cd ..

            # Bikin folder build
            mkdir build && cd build
            
            # Konfigurasi:
            # --host=aarch64-linux-gnu artinya: Hasil akhirnya buat jalan di ARM64
            # --target=aarch64-linux-gnu artinya: Dia bisa compile kode buat ARM64
            ../gcc-9.3.0/configure \
              --prefix=/opt/gcc-9.3.0 \
              --target=aarch64-linux-gnu \
              --host=aarch64-linux-gnu \
              --build=x86_64-linux-gnu \
              --enable-languages=c,c++ \
              --disable-multilib \
              --disable-nls \
              --with-system-zlib

            # Proses compile (Pake -j$(nproc) biar ngebut pake semua core GitHub)
            make -j\$(nproc)
            
            # Install ke folder sementara
            make install-strip DESTDIR=\$(pwd)/../install_dir
            
            # Packing hasil akhirnya
            cd ../install_dir/opt/gcc-9.3.0
            tar -czvf /workspace/gcc9-linux-aarch64.tar.gz .
          "

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: gcc9-linux-aarch64
          path: gcc9-linux-aarch64.tar.gz
